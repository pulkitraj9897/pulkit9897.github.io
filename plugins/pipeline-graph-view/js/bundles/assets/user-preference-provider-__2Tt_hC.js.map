{"version":3,"file":"user-preference-provider-__2Tt_hC.js","sources":["../../../../frontend/pipeline-console-view/pipeline-console/main/providers/user-preference-provider.tsx"],"sourcesContent":["import React, {\n  createContext,\n  ReactNode,\n  useContext,\n  useEffect,\n  useState,\n} from \"react\";\n\n// ENUMS\nexport enum StageViewPosition {\n  TOP = \"top\",\n  LEFT = \"left\",\n}\n\nexport enum MainViewVisibility {\n  BOTH = \"both\",\n  STAGES_ONLY = \"stagesOnly\",\n  GRAPH_ONLY = \"graphOnly\",\n}\n\n// TYPES\ninterface LayoutPreferences {\n  stageViewPosition: StageViewPosition;\n  mainViewVisibility: MainViewVisibility;\n  treeViewWidth: number;\n  stageViewWidth: number;\n  stageViewHeight: number;\n  setStageViewPosition: (position: StageViewPosition) => void;\n  setMainViewVisibility: (visibility: MainViewVisibility) => void;\n  setTreeViewWidth: (width: number) => void;\n  setStageViewWidth: (width: number) => void;\n  setStageViewHeight: (height: number) => void;\n}\n\n// CONTEXT\nconst LayoutPreferencesContext = createContext<LayoutPreferences | undefined>(\n  undefined,\n);\n\n// KEYS\nconst LS_KEYS = {\n  stageViewPosition: \"layout.stageViewPosition\",\n  treeViewVisibility: \"layout.treeViewVisibility\",\n  stageViewVisibility: \"layout.stageViewVisibility\",\n  mainViewVisibility: \"layout.mainViewVisibility\",\n  treeViewWidth: \"layout.treeViewWidth\",\n  stageViewWidth: \"layout.stageViewWidth\",\n  stageViewHeight: \"layout.stageViewHeight\",\n};\n\n// HELPER\nconst loadFromLocalStorage = <T,>(key: string, fallback: T): T => {\n  if (typeof window === \"undefined\") return fallback;\n  try {\n    const value = window.localStorage.getItem(key);\n    if (value !== null) {\n      if (typeof fallback === \"number\") {\n        return Number(value) as T;\n      }\n      return value as unknown as T;\n    }\n  } catch (e) {\n    console.error(`Error loading localStorage key \"${key}\"`, e);\n  }\n  return fallback;\n};\n\n// PROVIDER\nexport const LayoutPreferencesProvider = ({\n  children,\n}: {\n  children: ReactNode;\n}) => {\n  const [stageViewPosition, setStageViewPositionState] =\n    useState<StageViewPosition>(\n      loadFromLocalStorage(LS_KEYS.stageViewPosition, StageViewPosition.TOP),\n    );\n  const [mainViewVisibility, setMainViewVisibilityState] =\n    useState<MainViewVisibility>(\n      loadFromLocalStorage(LS_KEYS.mainViewVisibility, MainViewVisibility.BOTH),\n    );\n  const [treeViewWidth, setTreeViewWidthState] = useState<number>(\n    loadFromLocalStorage(LS_KEYS.treeViewWidth, 300),\n  );\n  const [stageViewWidth, setStageViewWidthState] = useState<number>(\n    loadFromLocalStorage(LS_KEYS.stageViewWidth, 600),\n  );\n  const [stageViewHeight, setStageViewHeightState] = useState<number>(\n    loadFromLocalStorage(LS_KEYS.stageViewHeight, 250),\n  );\n\n  // Save to localStorage\n  useEffect(() => {\n    window.localStorage.setItem(LS_KEYS.stageViewPosition, stageViewPosition);\n  }, [stageViewPosition]);\n\n  useEffect(() => {\n    window.localStorage.setItem(LS_KEYS.mainViewVisibility, mainViewVisibility);\n  }, [mainViewVisibility]);\n\n  useEffect(() => {\n    window.localStorage.setItem(\n      LS_KEYS.treeViewWidth,\n      treeViewWidth.toString(),\n    );\n  }, [treeViewWidth]);\n\n  useEffect(() => {\n    window.localStorage.setItem(\n      LS_KEYS.stageViewWidth,\n      stageViewWidth.toString(),\n    );\n  }, [stageViewWidth]);\n\n  useEffect(() => {\n    window.localStorage.setItem(\n      LS_KEYS.stageViewHeight,\n      stageViewHeight.toString(),\n    );\n  }, [stageViewHeight]);\n\n  // Setter wrappers\n  const setStageViewPosition = (position: StageViewPosition) =>\n    setStageViewPositionState(position);\n  const setMainViewVisibility = (visibility: MainViewVisibility) =>\n    setMainViewVisibilityState(visibility);\n  const setTreeViewWidth = (width: number) => setTreeViewWidthState(width);\n  const setStageViewWidth = (width: number) => setStageViewWidthState(width);\n  const setStageViewHeight = (height: number) =>\n    setStageViewHeightState(height);\n\n  return (\n    <LayoutPreferencesContext.Provider\n      value={{\n        stageViewPosition,\n        mainViewVisibility,\n        treeViewWidth,\n        stageViewWidth,\n        stageViewHeight,\n        setStageViewPosition,\n        setMainViewVisibility,\n        setTreeViewWidth,\n        setStageViewWidth,\n        setStageViewHeight,\n      }}\n    >\n      {children}\n    </LayoutPreferencesContext.Provider>\n  );\n};\n\n// HOOK\nexport const useLayoutPreferences = (): LayoutPreferences => {\n  const context = useContext(LayoutPreferencesContext);\n  if (!context) {\n    throw new Error(\n      \"useLayoutPreferences must be used within a LayoutPreferencesProvider\",\n    );\n  }\n  return context;\n};\n"],"names":["StageViewPosition","MainViewVisibility","LayoutPreferencesContext","createContext","LS_KEYS","loadFromLocalStorage","key","fallback","value","e","LayoutPreferencesProvider","children","stageViewPosition","setStageViewPositionState","useState","mainViewVisibility","setMainViewVisibilityState","treeViewWidth","setTreeViewWidthState","stageViewWidth","setStageViewWidthState","stageViewHeight","setStageViewHeightState","useEffect","setStageViewPosition","position","setMainViewVisibility","visibility","setTreeViewWidth","width","setStageViewWidth","setStageViewHeight","height","jsx","useLayoutPreferences","context","useContext"],"mappings":"qDASY,IAAAA,GAAAA,IACVA,EAAA,IAAM,MACNA,EAAA,KAAO,OAFGA,IAAAA,GAAA,CAAA,CAAA,EAKAC,GAAAA,IACVA,EAAA,KAAO,OACPA,EAAA,YAAc,aACdA,EAAA,WAAa,YAHHA,IAAAA,GAAA,CAAA,CAAA,EAqBZ,MAAMC,EAA2BC,EAAA,cAC/B,MACF,EAGMC,EAAU,CACd,kBAAmB,2BAGnB,mBAAoB,4BACpB,cAAe,uBACf,eAAgB,wBAChB,gBAAiB,wBACnB,EAGMC,EAAuB,CAAKC,EAAaC,IAAmB,CAC5D,GAAA,OAAO,OAAW,IAAoB,OAAAA,EACtC,GAAA,CACF,MAAMC,EAAQ,OAAO,aAAa,QAAQF,CAAG,EAC7C,GAAIE,IAAU,KACR,OAAA,OAAOD,GAAa,SACf,OAAOC,CAAK,EAEdA,QAEFC,EAAG,CACV,QAAQ,MAAM,mCAAmCH,CAAG,IAAKG,CAAC,CAAA,CAErD,OAAAF,CACT,EAGaG,EAA4B,CAAC,CACxC,SAAAC,CACF,IAEM,CACE,KAAA,CAACC,EAAmBC,CAAyB,EACjDC,EAAA,SACET,EAAqBD,EAAQ,kBAAmB,KAAqB,CACvE,EACI,CAACW,EAAoBC,CAA0B,EACnDF,EAAA,SACET,EAAqBD,EAAQ,mBAAoB,MAAuB,CAC1E,EACI,CAACa,EAAeC,CAAqB,EAAIJ,EAAA,SAC7CT,EAAqBD,EAAQ,cAAe,GAAG,CACjD,EACM,CAACe,EAAgBC,CAAsB,EAAIN,EAAA,SAC/CT,EAAqBD,EAAQ,eAAgB,GAAG,CAClD,EACM,CAACiB,EAAiBC,CAAuB,EAAIR,EAAA,SACjDT,EAAqBD,EAAQ,gBAAiB,GAAG,CACnD,EAGAmB,EAAAA,UAAU,IAAM,CACd,OAAO,aAAa,QAAQnB,EAAQ,kBAAmBQ,CAAiB,CAAA,EACvE,CAACA,CAAiB,CAAC,EAEtBW,EAAAA,UAAU,IAAM,CACd,OAAO,aAAa,QAAQnB,EAAQ,mBAAoBW,CAAkB,CAAA,EACzE,CAACA,CAAkB,CAAC,EAEvBQ,EAAAA,UAAU,IAAM,CACd,OAAO,aAAa,QAClBnB,EAAQ,cACRa,EAAc,SAAS,CACzB,CAAA,EACC,CAACA,CAAa,CAAC,EAElBM,EAAAA,UAAU,IAAM,CACd,OAAO,aAAa,QAClBnB,EAAQ,eACRe,EAAe,SAAS,CAC1B,CAAA,EACC,CAACA,CAAc,CAAC,EAEnBI,EAAAA,UAAU,IAAM,CACd,OAAO,aAAa,QAClBnB,EAAQ,gBACRiB,EAAgB,SAAS,CAC3B,CAAA,EACC,CAACA,CAAe,CAAC,EAGpB,MAAMG,EAAwBC,GAC5BZ,EAA0BY,CAAQ,EAC9BC,EAAyBC,GAC7BX,EAA2BW,CAAU,EACjCC,EAAoBC,GAAkBX,EAAsBW,CAAK,EACjEC,EAAqBD,GAAkBT,EAAuBS,CAAK,EACnEE,EAAsBC,GAC1BV,EAAwBU,CAAM,EAG9B,OAAAC,EAAA,IAAC/B,EAAyB,SAAzB,CACC,MAAO,CACL,kBAAAU,EACA,mBAAAG,EACA,cAAAE,EACA,eAAAE,EACA,gBAAAE,EACA,qBAAAG,EACA,sBAAAE,EACA,iBAAAE,EACA,kBAAAE,EACA,mBAAAC,CACF,EAEC,SAAApB,CAAA,CACH,CAEJ,EAGauB,EAAuB,IAAyB,CACrD,MAAAC,EAAUC,aAAWlC,CAAwB,EACnD,GAAI,CAACiC,EACH,MAAM,IAAI,MACR,sEACF,EAEK,OAAAA,CACT"}